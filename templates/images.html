{% extends "base.html" %}
{% block title %}eagle viewer{% endblock %}
{% block bodyattr %} oncontextmenu='return false;'{% endblock %}
{% block navbar %}
<ul class="navbar-nav">
    <li class="nav-item">
        <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
            {% if foldername %}{{ foldername }}{% else %}フォルダー{% endif %}
        </button>
        <ul id="folder_dropdown" class="dropdown-menu">
            <li><a class="dropdown-item" href="/eagle?folder=">全画像</a></li>
            <li><a class="dropdown-item" href="/eagle?folder=,">未分類</a></li>
            <li class="has-dropdown-menu-sub">
                <a class="dropdown-item" href="/eagle?folder=star">星</a>
                <ul class="dropdown-menu-sub">
                <a class="dropdown-item" href="/eagle?folder=star5">星5</a>
                <a class="dropdown-item" href="/eagle?folder=star4">星4</a>
                <a class="dropdown-item" href="/eagle?folder=star3">星3</a>
                <a class="dropdown-item" href="/eagle?folder=star2">星2</a>
                <a class="dropdown-item" href="/eagle?folder=star1">星1</a>
                <a class="dropdown-item" href="/eagle?folder=star0">星0</a>
                </ul>
            </li>
            <li><hr class="dropdown-divider"></li>
            {% for f in folders -%}
            {% if f.children %}
            <li class="has-dropdown-menu-sub">
                <a class="dropdown-item" href="/eagle?folder={{- f.id -}}">{{- f.name -}}</a>
                <ul class="dropdown-menu-sub">
                {% for ff in f.children %}
                    <a class="dropdown-item" href="/eagle?folder={{- ff.id -}}">{{- ff.name -}}</a>
                {% endfor %}
                </ul>
            </li>
            {% else %}
            <li>
                <a class="dropdown-item" href="/eagle?folder={{- f.id -}}">{{- f.name -}}</a>
            </li>
            {% endif %}
            {% endfor %}
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#" onclick="resumeserver();">再起動</a></li>
            <li><a class="dropdown-item" href="#" onclick="updatedb();">DB読み込み</a></li>
        </ul>
    </li>
    <li class="nav-item">
        <button type="button" class="nav-item btn btn-primary" aria-expanded="false" onclick="flipScreenMode()">
            ⇔
        </button>
    </li>
</ul>
<form id="search" class="d-flex" role="search" method="get">
    <input class="form-control" type="input" placeholder="キーワード" aria-label="keyword" name="keyword">
    <button class="btn btn-outline-success" type="submit">検索</button>
</form>
{% endblock %}
{% block body %}
<div id="eagle_main" class="container">
<div id="img_slide" class="text-center" data-bs-wrap="false">
<div id="img_grids" class="row row-cols-auto">
{% for img in list -%}
<div id="img_{{- img.id -}}" class="col" tabindex="1">
    <a onclick='onimageclick(event, "{{- img.id -}}");'><img class="img-thumbnail" src="/images/{{- img.id -}}/{{- img.thumbname -}}" width="{{- img.thumbwidth -}}px" height="{{- img.thumbheight -}}px"
        {% if img.noThumbnail %}data-rsrc="/images/{{- img.id -}}/{{- img.name -}}.{{- img.ext -}}"{% endif %}></a>
    <div class="img_star badge bg-dark">{{- img.star if img.star -}}</div>
    {% for fld in img.folders -%}
    <div class="img_folder badge bg-info">{{- fld -}}</div>
    {% endfor -%}
    {% for tag in img.tags -%}
    <div class="img_tag badge bg-secondary">{{- tag -}}</div>
    {% endfor -%}
    <div class="img_annotation bg-primary text-wrap">{{- img.annotation -}}</div>
</div>
{% endfor -%}
<div id="img_next" class="col" tabindex="1">
    <button id="fillnext_button" onclick="fillnext()">読み込み</button>
</div>
</div>
<button class="carousel-control-prev" type="button" data-bs-target="#img_slide" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
</button>
<button class="carousel-control-next" type="button" data-bs-target="#img_slide" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
</button>
</div>    
</div>
{% endblock %}
{% block script %}
<div id="starcontextmenu" class="modal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <ul class="list-group">
                <li class="list-group-item" onclick="addStar(5)">星5</li>
                <li class="list-group-item" onClick="addStar(4)">星4</li>
                <li class="list-group-item" onClick="addStar(3)">星3</li>
                <li class="list-group-item" onClick="addStar(2)">星2</li>
                <li class="list-group-item" onClick="addStar(1)">星1</li>
                <li class="list-group-item" onClick="addStar(0)">星0</li>
                <li class="list-group-item" onClick="contextmenuclose()">閉じる</li>
            </ul>
        </div>
    </div>
</div>
<div id="updating">
    <div class="message">DB更新中...</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
<script src="static/js/images.js"></script>
{% endblock %}
